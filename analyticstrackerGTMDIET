!function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["analyticstracker"],function(analyticstracker){return root.analyticsTransGTMDIET=factory(analyticstracker,window)}):"object"==typeof exports?module.exports=factory(require("analyticstracker"),window):root.analyticsTransGTMDIET=factory(root.analyticstracker,window)}(this,function(analyticstracker,w){"use strict";var _instance,analyticsTransGTMDIET=function analyticsTransGTMDIET(){if(!(this instanceof analyticsTransGTMDIET))return new analyticsTransGTMDIET;this.tracker=analyticstracker(),void 0!==w&&null!=w&&(w.dataLayer=w.dataLayer||[]),this._version="1.0.2",this._subscribe()};return analyticsTransGTMDIET.prototype.getInstance=function(){return _instance||(_instance=analyticsTransGTMDIET()),_instance},analyticsTransGTMDIET.prototype._subscribe=function(){try{this.tracker.trackingSubscribe("GTMDIET",function(event,data){function clone(a){return JSON.parse(JSON.stringify(a))}function isArray(obj){return!!obj&&obj.constructor===Array}function isEShop(eventdata){return eventdata.hasOwnProperty("pageInfo")&&eventdata.pageInfo.hasOwnProperty("platform")&&"eshop"==eventdata.pageInfo.platform}function isCarCommerce(commerceObj){var firstEntry=null;if(isArray(commerceObj)){if(0==commerceObj.length)return!1;firstEntry=commerceObj[0]}else firstEntry=commerceObj;return firstEntry.hasOwnProperty("carBrand")&&firstEntry.hasOwnProperty("carModel")&&""!==firstEntry.carBrand}function isProductCommerce(commerceObj){var firstEntry=null;if(isArray(commerceObj)){if(0==commerceObj.length)return!1;firstEntry=commerceObj[0]}else firstEntry=commerceObj;return firstEntry.hasOwnProperty("productName")&&""!==firstEntry.productName||firstEntry.hasOwnProperty("productID")&&""!==firstEntry.productID}function eeProdTrans(commerceObj){var refArray=isArray(commerceObj)?commerceObj:[commerceObj],gtmPArray=[];for(entry of refArray){var pEntry={id:entry.hasOwnProperty("productID")?entry.productID:"",name:entry.hasOwnProperty("productName")?entry.productName:"",price:entry.hasOwnProperty("productPrice")?entry.productPrice:0,brand:entry.hasOwnProperty("productBrand")?entry.productBrand:"",quantity:entry.hasOwnProperty("productQuantity")&&""!=entry.productQuantity?entry.productQuantity:1,category:"",variant:"",list:"shop",position:0};gtmPArray.push(pEntry)}return gtmPArray}function eeCarTrans(commerceObj){var refArray=isArray(commerceObj)?commerceObj:[commerceObj],gtmPArray=[];for(entry of refArray){var pEntry={id:entry.hasOwnProperty("referenceID")?entry.referenceID:"",name:entry.hasOwnProperty("carModel")?entry.carModel:"",price:entry.hasOwnProperty("carPrice")?entry.carPrice:0,brand:entry.hasOwnProperty("carBrand")?entry.carBrand:"",quantity:1,category:"",variant:entry.hasOwnProperty("carBodyType")?entry.carBodyType:"",list:"carshop",position:0};gtmPArray.push(pEntry)}return gtmPArray}function getOrderId(commerceObj){var firstEntry=null;if(isArray(commerceObj)){if(0==commerceObj.length)return"";firstEntry=commerceObj[0]}else firstEntry=commerceObj;return firstEntry.hasOwnProperty("orderID")?firstEntry.orderID:""}function getOrderRevenu(commerceObj){var firstEntry=null;if(isArray(commerceObj)){if(0==commerceObj.length)return"";firstEntry=commerceObj[0]}else firstEntry=commerceObj;return firstEntry.hasOwnProperty("orderRevenu")?firstEntry.orderRevenu:""}if(void 0!==w&&null!=w){var gtmData={};switch(event){case"product-impression":if(data.hasOwnProperty("commerce")){var cArray=[];if(isCarCommerce(data.commerce)&&isArray(data.commerce))for(var entry of data.commerce){var edata=clone(data);edata.commerce=clone(entry),cArray.push(edata)}else cArray.push(data);for(var cItem of cArray)isEShop(data)?isProductCommerce(cItem.commerce)?((gtmData=clone(cItem)).ecommerce={currencyCode:"EUR",impressions:eeProdTrans(cItem.commerce)},w.dataLayer.push(gtmData)):isCarCommerce(cItem.commerce)?((gtmData=clone(cItem)).ecommerce={currencyCode:"EUR",impressions:eeProdTrans(cItem.commerce)},w.dataLayer.push(gtmData)):w.dataLayer.push(cItem):w.dataLayer.push(cItem)}else w.dataLayer.push(data);break;case"product-detail":isEShop(data)&&data.hasOwnProperty("commerce")?isProductCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={detail:{actionField:{list:"shop"},products:eeProdTrans(data.commerce)}},w.dataLayer.push(gtmData)):isCarCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={detail:{actionField:{list:"carshop"},products:eeCarTrans(data.commerce)}},w.dataLayer.push(gtmData)):w.dataLayer.push(data):w.dataLayer.push(data);break;case"product-click":isEShop(data)&&data.hasOwnProperty("commerce")?isProductCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={click:{actionField:{list:"shop"},products:eeProdTrans(data.commerce)}},w.dataLayer.push(gtmData)):isCarCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={click:{actionField:{list:"carshop"},products:eeCarTrans(data.commerce)}},w.dataLayer.push(gtmData)):w.dataLayer.push(data):w.dataLayer.push(data);break;case"product-addtocart":isEShop(data)&&data.hasOwnProperty("commerce")?isProductCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={currencyCode:"EUR",add:{products:eeProdTrans(data.commerce)}},w.dataLayer.push(gtmData)):isCarCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={currencyCode:"EUR",add:{products:eeCarTrans(data.commerce)}},w.dataLayer.push(gtmData)):w.dataLayer.push(data):w.dataLayer.push(data);break;case"tool-start":data.hasOwnProperty("info")&&data.info.hasOwnProperty("toolType")&&"checkout"==data.info.toolType&&isEShop(data)&&data.hasOwnProperty("commerce")?isProductCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={checkout:{actionField:{step:data.info.hasOwnProperty("toolStepNumber")?data.info.toolStepNumber:0,option:data.info.hasOwnProperty("toolStepOption")?data.info.toolStepOption:""},products:eeProdTrans(data.commerce)}},w.dataLayer.push(gtmData)):isCarCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={checkout:{actionField:{step:data.info.hasOwnProperty("toolStepNumber")?data.info.toolStepNumber:0,option:data.info.hasOwnProperty("toolStepOption")?data.info.toolStepOption:""},products:eeCarTrans(data.commerce)}},w.dataLayer.push(gtmData)):w.dataLayer.push(data):w.dataLayer.push(data);break;case"tool-complete":data.hasOwnProperty("info")&&data.info.hasOwnProperty("toolType")&&"checkout"==data.info.toolType&&isEShop(data)&&data.hasOwnProperty("commerce")?isProductCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={purchase:{actionField:{id:getOrderId(data.commerce),revenue:getOrderRevenu(data.commerce)},products:eeProdTrans(data.commerce)}},w.dataLayer.push(gtmData)):isCarCommerce(data.commerce)?((gtmData=clone(data)).ecommerce={purchase:{actionField:{id:getOrderId(data.commerce),revenue:getOrderRevenu(data.commerce)},products:eeCarTrans(data.commerce)}},w.dataLayer.push(gtmData)):w.dataLayer.push(data):w.dataLayer.push(data);break;default:w.dataLayer.push(data)}}})}catch(e){}},_instance=analyticsTransGTMDIET(),analyticsTransGTMDIET.prototype.getInstance});
